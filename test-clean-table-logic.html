<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Clean Table Logic - Ch·ªù thanh to√°n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>üß™ Test Logic Clean Table v·ªõi Tr·∫°ng th√°i "Ch·ªù thanh to√°n"</h1>
        
        <div class="alert alert-info">
            <h5>üìã C√°c c·∫£i ti·∫øn ƒë√£ th·ª±c hi·ªán:</h5>
            <ul>
                <li>‚úÖ <strong>Query Firestore tr·ª±c ti·∫øp</strong> thay v√¨ d·ª±a v√†o memory</li>
                <li>‚úÖ <strong>Ki·ªÉm tra real-time</strong> paymentStatus c·ªßa orders</li>
                <li>‚úÖ <strong>Auto-update</strong> tr·∫°ng th√°i b√†n khi thanh to√°n xong</li>
                <li>‚úÖ <strong>Force Clean button</strong> cho tr∆∞·ªùng h·ª£p kh·∫©n c·∫•p</li>
                <li>‚úÖ <strong>Detailed logging</strong> ƒë·ªÉ debug d·ªÖ d√†ng</li>
            </ul>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5>üîÑ Logic m·ªõi cho cleanTable()</h5>
                    </div>
                    <div class="card-body">
                        <ol>
                            <li><strong>Ki·ªÉm tra tr·∫°ng th√°i b√†n:</strong>
                                <br><small class="text-muted">N·∫øu b√†n ·ªü tr·∫°ng th√°i "pending_payment"</small>
                            </li>
                            <li><strong>Query Firestore tr·ª±c ti·∫øp:</strong>
                                <br><small class="text-muted">
                                    <code>query(collection(db, "orders"), where("tableId", "==", tableId), where("status", "==", "completed"))</code>
                                </small>
                            </li>
                            <li><strong>Ki·ªÉm tra paymentStatus:</strong>
                                <br><small class="text-muted">T·∫•t c·∫£ orders completed ph·∫£i c√≥ paymentStatus === "paid"</small>
                            </li>
                            <li><strong>Cho ph√©p d·ªçn b√†n:</strong>
                                <br><small class="text-muted">Ch·ªâ khi t·∫•t c·∫£ orders ƒë√£ thanh to√°n</small>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5>üö® Force Clean Button</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Khi n√†o s·ª≠ d·ª•ng:</strong></p>
                        <ul>
                            <li>C√≥ l·ªói d·ªØ li·ªáu</li>
                            <li>Kh√°ch b·ªè ƒëi kh√¥ng thanh to√°n</li>
                            <li>C·∫ßn d·ªçn b√†n kh·∫©n c·∫•p</li>
                            <li>Debugging/Testing</li>
                        </ul>
                        <div class="alert alert-danger">
                            <small><strong>‚ö†Ô∏è L∆∞u √Ω:</strong> Button n√†y b·ªè qua t·∫•t c·∫£ ki·ªÉm tra v√† d·ªçn b√†n ngay l·∫≠p t·ª©c!</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5>üéØ Test Scenarios</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Scenario</th>
                                    <th>Tr·∫°ng th√°i b√†n</th>
                                    <th>PaymentStatus</th>
                                    <th>K·∫øt qu·∫£ mong ƒë·ª£i</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Order completed, ch∆∞a thanh to√°n</td>
                                    <td><span class="badge bg-warning">pending_payment</span></td>
                                    <td><span class="badge bg-danger">null/unpaid</span></td>
                                    <td>‚ùå Kh√¥ng cho d·ªçn b√†n</td>
                                    <td>
                                        <button class="btn btn-success btn-sm">Clean Table</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Order completed, ƒë√£ thanh to√°n</td>
                                    <td><span class="badge bg-warning">pending_payment</span></td>
                                    <td><span class="badge bg-success">paid</span></td>
                                    <td>‚úÖ Cho ph√©p d·ªçn b√†n</td>
                                    <td>
                                        <button class="btn btn-success btn-sm">Clean Table</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>B√†n tr·ªëng</td>
                                    <td><span class="badge bg-success">available</span></td>
                                    <td>-</td>
                                    <td>‚úÖ Kh√¥ng c·∫ßn ki·ªÉm tra</td>
                                    <td>
                                        <button class="btn btn-success btn-sm">Clean Table</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Force clean (emergency)</td>
                                    <td><span class="badge bg-warning">pending_payment</span></td>
                                    <td><span class="badge bg-danger">null/unpaid</span></td>
                                    <td>‚úÖ D·ªçn b√†n ngay l·∫≠p t·ª©c</td>
                                    <td>
                                        <button class="btn btn-danger btn-sm">Force Clean</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5>üîç Debug Information</h5>
                </div>
                <div class="card-body">
                    <p><strong>Console logs ƒë·ªÉ theo d√µi:</strong></p>
                    <ul>
                        <li><code>Cleaning table: [tableId] current status: [status]</code></li>
                        <li><code>Checking payment status for table: [tableId]</code></li>
                        <li><code>Found orders for table: [orders array]</code></li>
                        <li><code>Unpaid orders: [unpaid orders array]</code></li>
                        <li><code>All orders are paid, proceeding to clean table</code></li>
                        <li><code>Table status updated to 'available' in Firestore</code></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <div class="alert alert-success">
                <h5>‚úÖ T·ªïng k·∫øt:</h5>
                <p>Logic "Ch·ªù thanh to√°n" ƒë√£ ƒë∆∞·ª£c ho√†n thi·ªán v·ªõi:</p>
                <ul class="mb-0">
                    <li><strong>Real-time checking:</strong> Query Firestore tr·ª±c ti·∫øp thay v√¨ d·ª±a v√†o memory</li>
                    <li><strong>Smart validation:</strong> Ki·ªÉm tra paymentStatus ch√≠nh x√°c</li>
                    <li><strong>Auto-update:</strong> T·ª± ƒë·ªông c·∫≠p nh·∫≠t khi c√≥ thanh to√°n</li>
                    <li><strong>Emergency handle:</strong> Force clean cho tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát</li>
                    <li><strong>User-friendly:</strong> Th√¥ng b√°o r√µ r√†ng v·ªÅ l√Ω do kh√¥ng th·ªÉ d·ªçn b√†n</li>
                </ul>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="waiter-dashboard.html" class="btn btn-primary btn-lg">
                üöÄ Tr·ªü v·ªÅ Dashboard ƒë·ªÉ Test
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
