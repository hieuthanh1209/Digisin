<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chef-Waiter Integration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0">Test Chef-Waiter Integration</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <strong>Test Flow:</strong> Script n√†y s·∫Ω t·∫°o orders m·∫´u v·ªõi c√°c m√≥n ƒÉn c√≥ s·∫µn c√¥ng th·ª©c 
                            ƒë·ªÉ test vi·ªác ƒë·ªìng b·ªô gi·ªØa waiter v√† chef dashboard.
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <button id="addMenuBtn" class="btn btn-success w-100">
                                    1. Th√™m Menu Items
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button id="addOrdersBtn" class="btn btn-primary w-100" disabled>
                                    2. T·∫°o Orders Test
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button id="clearDataBtn" class="btn btn-danger w-100">
                                    X√≥a D·ªØ li·ªáu Test
                                </button>
                            </div>
                        </div>
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <a href="../dashboard/waiter-dashboard.html" class="btn btn-outline-primary w-100" target="_blank">
                                    üçΩÔ∏è M·ªü Waiter Dashboard
                                </a>
                            </div>
                            <div class="col-md-6">
                                <a href="../dashboard/chef-dashboard.html" class="btn btn-outline-secondary w-100" target="_blank">
                                    üë®‚Äçüç≥ M·ªü Chef Dashboard
                                </a>
                            </div>
                        </div>
                        
                        <div id="result" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import {
          getFirestore,
          collection,
          doc,
          setDoc,
          addDoc,
          deleteDoc,
          getDocs,
          Timestamp,
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import firebaseConfig from "../config/firebase-config.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const resultDiv = document.getElementById('result');

        // Sample menu items with recipes
        const sampleMenuItems = [
          {
            id: "pho-bo",
            name: "Ph·ªü B√≤",
            category: "M√≥n ch√≠nh",
            price: 85000,
            description: "Ph·ªü b√≤ truy·ªÅn th·ªëng v·ªõi n∆∞·ªõc d·∫ßm ƒë·∫≠m ƒë√†",
            ingredients: [
              "Th·ªãt b√≤ t√°i", "B√°nh ph·ªü", "H√†nh l√°", "Ng√≤ gai", "Gi√° ƒë·ªó", "Chanh", "·ªöt"
            ],
            recipe: {
              steps: [
                "Lu·ªôc b√°nh ph·ªü v·ªõi n∆∞·ªõc s√¥i trong 2-3 ph√∫t",
                "X·∫øp b√°nh ph·ªü v√†o t√¥, cho th·ªãt b√≤ t√°i l√™n tr√™n",
                "Chan n∆∞·ªõc d√πng n√≥ng v√†o t√¥",
                "Th√™m h√†nh l√°, ng√≤ gai, gi√° ƒë·ªó",
                "ƒÇn k√®m v·ªõi chanh v√† ·ªõt"
              ],
              preparationTime: 5,
              cookingTime: 15,
              difficulty: "easy",
              servings: 1
            },
            cookingTime: 15,
            difficulty: "easy",
            available: true,
            createdAt: Timestamp.now()
          },
          {
            id: "com-tam",
            name: "C∆°m T·∫•m S∆∞·ªùn N∆∞·ªõng",
            category: "M√≥n ch√≠nh", 
            price: 75000,
            description: "C∆°m t·∫•m v·ªõi s∆∞·ªùn n∆∞·ªõng th∆°m ngon",
            ingredients: [
              "C∆°m t·∫•m", "S∆∞·ªùn heo", "ƒê·ªì chua", "N∆∞·ªõc m·∫Øm pha", "H√†nh phi", "M·ª° h√†nh"
            ],
            recipe: {
              steps: [
                "∆Ø·ªõp s∆∞·ªùn v·ªõi gia v·ªã trong 30 ph√∫t",
                "N∆∞·ªõng s∆∞·ªùn tr√™n b·∫øp than ho·∫∑c l√≤ n∆∞·ªõng 15-20 ph√∫t",
                "N·∫•u c∆°m t·∫•m",
                "Chu·∫©n b·ªã ƒë·ªì chua v√† n∆∞·ªõc m·∫Øm pha",
                "B√†y c∆°m ra ƒëƒ©a, x·∫øp s∆∞·ªùn n∆∞·ªõng l√™n tr√™n",
                "R∆∞·ªõi m·ª° h√†nh, ƒÉn k√®m ƒë·ªì chua"
              ],
              preparationTime: 35,
              cookingTime: 20,
              difficulty: "medium",
              servings: 1
            },
            cookingTime: 20,
            difficulty: "medium",
            available: true,
            createdAt: Timestamp.now()
          },
          {
            id: "banh-mi",
            name: "B√°nh M√¨ Th·ªãt N∆∞·ªõng",
            category: "ƒê·ªì ƒÉn nhanh",
            price: 25000,
            description: "B√°nh m√¨ gi√≤n v·ªõi th·ªãt n∆∞·ªõng th∆°m l·ª´ng",
            ingredients: [
              "B√°nh m√¨", "Th·ªãt heo n∆∞·ªõng", "ƒê·ªì chua", "Rau th∆°m", "·ªöt", "T∆∞∆°ng ·ªõt", "Mayonnaise"
            ],
            recipe: {
              steps: [
                "N∆∞·ªõng b√°nh m√¨ ƒë·∫øn khi gi√≤n v√†ng",
                "R·∫°ch b√°nh m√¨, ph·∫øt mayonnaise v√† t∆∞∆°ng ·ªõt",
                "Cho th·ªãt n∆∞·ªõng v√†o b√°nh",
                "Th√™m ƒë·ªì chua, rau th∆°m, ·ªõt",
                "G√≥i b√°nh v√† ph·ª•c v·ª•"
              ],
              preparationTime: 3,
              cookingTime: 5,
              difficulty: "easy", 
              servings: 1
            },
            cookingTime: 5,
            difficulty: "easy",
            available: true,
            createdAt: Timestamp.now()
          }
        ];

        // Sample orders
        const sampleOrders = [
          {
            tableNumber: "B01",
            tableName: "B01",
            items: [
              {
                id: "pho-bo",
                name: "Ph·ªü B√≤",
                price: 85000,
                quantity: 2,
                note: "√çt h√†nh",
                itemStatus: "pending"
              },
              {
                id: "com-tam",
                name: "C∆°m T·∫•m S∆∞·ªùn N∆∞·ªõng", 
                price: 75000,
                quantity: 1,
                note: "",
                itemStatus: "pending"
              }
            ],
            status: "pending",
            totalAmount: 245000,
            createdAt: Timestamp.now(),
            updatedAt: Timestamp.now(),
            createdBy: "waiter-test"
          },
          {
            tableNumber: "B02",
            tableName: "B02",
            items: [
              {
                id: "banh-mi",
                name: "B√°nh M√¨ Th·ªãt N∆∞·ªõng",
                price: 25000,
                quantity: 3,
                note: "Kh√¥ng ·ªõt",
                itemStatus: "pending"
              }
            ],
            status: "pending",
            totalAmount: 75000,
            createdAt: Timestamp.now(),
            updatedAt: Timestamp.now(),
            createdBy: "waiter-test"
          },
          {
            tableNumber: "B03",
            tableName: "B03",
            items: [
              {
                id: "pho-bo",
                name: "Ph·ªü B√≤",
                price: 85000,
                quantity: 1,
                note: "",
                itemStatus: "cooking"
              },
              {
                id: "banh-mi",
                name: "B√°nh M√¨ Th·ªãt N∆∞·ªõng",
                price: 25000,
                quantity: 2,
                note: "",
                itemStatus: "pending"
              }
            ],
            status: "cooking",
            totalAmount: 135000,
            createdAt: Timestamp.fromDate(new Date(Date.now() - 10 * 60 * 1000)), // 10 minutes ago
            updatedAt: Timestamp.now(),
            createdBy: "waiter-test"
          }
        ];

        // Add menu items
        document.getElementById('addMenuBtn').addEventListener('click', async () => {
          const button = document.getElementById('addMenuBtn');
          button.disabled = true;
          button.textContent = 'ƒêang th√™m menu...';
          
          try {
            resultDiv.innerHTML = '<div class="alert alert-info">ƒêang th√™m menu items...</div>';
            
            for (const item of sampleMenuItems) {
              const menuRef = doc(db, "menu_items", item.id);
              await setDoc(menuRef, item);
            }
            
            resultDiv.innerHTML = `
              <div class="alert alert-success">
                <h5>‚úÖ ƒê√£ th√™m menu items th√†nh c√¥ng!</h5>
                <ul class="mb-0">
                  ${sampleMenuItems.map(item => `<li>${item.name} (${item.id})</li>`).join('')}
                </ul>
              </div>
            `;
            
            document.getElementById('addOrdersBtn').disabled = false;
            
          } catch (error) {
            console.error('L·ªói:', error);
            resultDiv.innerHTML = `<div class="alert alert-danger">L·ªói: ${error.message}</div>`;
          } finally {
            button.disabled = false;
            button.textContent = '1. Th√™m Menu Items';
          }
        });

        // Add sample orders
        document.getElementById('addOrdersBtn').addEventListener('click', async () => {
          const button = document.getElementById('addOrdersBtn');
          button.disabled = true;
          button.textContent = 'ƒêang t·∫°o orders...';
          
          try {
            resultDiv.innerHTML = '<div class="alert alert-info">ƒêang t·∫°o sample orders...</div>';
            
            const addedOrders = [];
            for (const order of sampleOrders) {
              const orderRef = await addDoc(collection(db, "orders"), order);
              addedOrders.push({...order, id: orderRef.id});
            }
            
            resultDiv.innerHTML = `
              <div class="alert alert-success">
                <h5>‚úÖ ƒê√£ t·∫°o orders th√†nh c√¥ng!</h5>
                <div class="row g-3">
                  ${addedOrders.map(order => `
                    <div class="col-md-4">
                      <div class="card border-0 shadow-sm">
                        <div class="card-body p-3">
                          <h6 class="card-title mb-2">Order #${order.id.slice(-5).toUpperCase()}</h6>
                          <p class="card-text small mb-2">
                            <strong>B√†n:</strong> ${order.tableName}<br>
                            <strong>Tr·∫°ng th√°i:</strong> ${order.status}<br>
                            <strong>T·ªïng ti·ªÅn:</strong> ${order.totalAmount.toLocaleString()}ƒë
                          </p>
                          <div class="small text-muted">
                            <strong>M√≥n ƒÉn:</strong>
                            <ul class="mb-0 ps-3">
                              ${order.items.map(item => `<li>${item.quantity}x ${item.name}</li>`).join('')}
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  `).join('')}
                </div>
                <div class="mt-3 p-3 bg-light rounded">
                  <strong>H∆∞·ªõng d·∫´n test:</strong>
                  <ol class="mb-0 mt-2">
                    <li>M·ªü <strong>Chef Dashboard</strong> - s·∫Ω th·∫•y orders c√≥ tr·∫°ng th√°i "pending" v√† "cooking"</li>
                    <li>Click v√†o n√∫t <strong>"C√¥ng th·ª©c"</strong> ƒë·ªÉ xem chi ti·∫øt nguy√™n li·ªáu v√† c√°ch l√†m</li>
                    <li>Th·ª≠ thay ƒë·ªïi tr·∫°ng th√°i order t·ª´ pending ‚Üí cooking ‚Üí ready</li>
                    <li>M·ªü <strong>Waiter Dashboard</strong> ƒë·ªÉ xem s·ª± ƒë·ªìng b·ªô real-time</li>
                  </ol>
                </div>
              </div>
            `;
            
          } catch (error) {
            console.error('L·ªói:', error);
            resultDiv.innerHTML = `<div class="alert alert-danger">L·ªói: ${error.message}</div>`;
          } finally {
            button.disabled = false;
            button.textContent = '2. T·∫°o Orders Test';
          }
        });

        // Clear test data
        document.getElementById('clearDataBtn').addEventListener('click', async () => {
          if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu test?')) return;
          
          const button = document.getElementById('clearDataBtn');
          button.disabled = true;
          button.textContent = 'ƒêang x√≥a...';
          
          try {
            resultDiv.innerHTML = '<div class="alert alert-warning">ƒêang x√≥a d·ªØ li·ªáu test...</div>';
            
            // Delete orders
            const ordersSnapshot = await getDocs(collection(db, "orders"));
            const orderDeletePromises = ordersSnapshot.docs.map(doc => deleteDoc(doc.ref));
            await Promise.all(orderDeletePromises);
            
            // Delete menu items
            const menuDeletePromises = sampleMenuItems.map(item => 
              deleteDoc(doc(db, "menu_items", item.id))
            );
            await Promise.all(menuDeletePromises);
            
            resultDiv.innerHTML = `
              <div class="alert alert-success">
                <h5>‚úÖ ƒê√£ x√≥a d·ªØ li·ªáu test th√†nh c√¥ng!</h5>
                <p class="mb-0">ƒê√£ x√≥a ${ordersSnapshot.docs.length} orders v√† ${sampleMenuItems.length} menu items</p>
              </div>
            `;
            
            document.getElementById('addOrdersBtn').disabled = true;
            
          } catch (error) {
            console.error('L·ªói:', error);
            resultDiv.innerHTML = `<div class="alert alert-danger">L·ªói: ${error.message}</div>`;
          } finally {
            button.disabled = false;
            button.textContent = 'X√≥a D·ªØ li·ªáu Test';
          }
        });
    </script>
</body>
</html>
