<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Demo - Simple Version</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #f8f9fa; 
            padding: 20px;
            margin: 0;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        .demo-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .row { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
        }
        .col { 
            flex: 1; 
            min-width: 250px; 
        }
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        .btn-success { background: #28a745; color: white; }
        .btn-primary { background: #007bff; color: white; }
        .btn:hover { opacity: 0.8; }
        .invoice-preview {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            max-width: 400px;
            margin: 0 auto;
        }
        .text-center { text-align: center; }
        .mb-3 { margin-bottom: 1rem; }
        .mt-3 { margin-top: 1rem; }
        .form-label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
        }
        h1 { color: #007bff; }
        h4 { color: #28a745; }

        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .invoice-preview, .invoice-preview * {
                visibility: visible;
            }
            .invoice-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 15px;
                border: none;
                background: white;
            }
            @page {
                size: A5;
                margin: 10mm;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-3">
            <h1>üî≤ QR Code Demo - Simple</h1>
            <p>Demo t√≠nh nƒÉng m√£ QR thanh to√°n cho h√≥a ƒë∆°n</p>
        </div>
        
        <!-- Demo Controls -->
        <div class="demo-card">
            <h3>‚öôÔ∏è QR Code Generator</h3>
            <div class="row">
                <div class="col">
                    <label class="form-label">M√£ ƒë∆°n h√†ng:</label>
                    <input type="text" class="form-control" id="orderId" value="HD001" placeholder="HD001">
                </div>
                <div class="col">
                    <label class="form-label">S·ªë b√†n:</label>
                    <input type="text" class="form-control" id="tableNumber" value="B√†n 5" placeholder="B√†n 5">
                </div>
                <div class="col">
                    <label class="form-label">S·ªë ti·ªÅn:</label>
                    <input type="number" class="form-control" id="amount" value="165000" placeholder="165000">
                </div>
            </div>
            <div class="text-center mt-3">
                <button class="btn btn-success" onclick="generateInvoiceWithQR()">
                    üìÑ T·∫°o h√≥a ƒë∆°n v·ªõi PayOS QR
                </button>
            </div>
        </div>
        
        <!-- Invoice Preview -->
        <div class="demo-card" id="invoiceSection" style="display: none;">
            <h4>üìã H√≥a ƒë∆°n v·ªõi PayOS QR Code</h4>
            <div class="invoice-preview" id="invoicePreview">
                <!-- Invoice preview will be displayed here -->
            </div>
            <div class="text-center mt-3">
                <button class="btn btn-primary" onclick="printInvoice()">
                    üñ®Ô∏è In h√≥a ƒë∆°n
                </button>
            </div>
        </div>
        
        <!-- Debug Info -->
        <div class="demo-card">
            <h4>üêõ Debug Info</h4>
            <div id="debugInfo" style="font-family: monospace; font-size: 12px; background: #f8f9fa; padding: 15px; border-radius: 4px;">
                Ch∆∞a c√≥ debug info...
            </div>
        </div>
        
        <!-- Back Link -->
        <div class="text-center mt-3">
            <a href="test-qr.html" class="btn btn-primary">‚Üê V·ªÅ Test QR ƒë∆°n gi·∫£n</a>
        </div>
    </div>

    <script>
        // Debug function
        function debugLog(message) {
            console.log(message);
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }

        // Currency formatter
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN').format(amount) + '‚Ç´';
        }

        // Generate PayOS QR URL
        function getPayOSQRUrl(orderId, table, amount) {
            const addInfo = `TT ${orderId} ${table}`.replace(/\s+/g, '+');
            const qrUrl = `https://img.vietqr.io/image/970452-10142505304746708-payos.jpg?addInfo=${addInfo}&amount=${amount}`;
            debugLog('Generated QR URL: ' + qrUrl);
            return qrUrl;
        }

        // Main function to generate invoice
        function generateInvoiceWithQR() {
            debugLog('Starting invoice generation...');
            
            try {
                const orderId = document.getElementById('orderId').value || 'HD001';
                const table = document.getElementById('tableNumber').value || 'B√†n 5';
                const amount = parseInt(document.getElementById('amount').value) || 165000;
                
                debugLog('Order: ' + orderId + ', Table: ' + table + ', Amount: ' + amount);
                
                const qrUrl = getPayOSQRUrl(orderId, table, amount);
                
                const subtotal = amount;
                const taxAmount = Math.round(subtotal * 0.08);
                const finalTotal = subtotal + taxAmount;
                
                // Build invoice HTML in parts to avoid template literal issues
                let invoiceHtml = '';
                
                // Header
                invoiceHtml += '<div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">';
                invoiceHtml += '<h2 style="margin: 0; font-size: 18px; font-weight: bold;">NH√Ä H√ÄNG ABC</h2>';
                invoiceHtml += '<p style="margin: 5px 0 0 0; font-size: 12px;">123 ƒê∆∞·ªùng XYZ, Qu·∫≠n 1, TP.HCM</p>';
                invoiceHtml += '<p style="margin: 2px 0 0 0; font-size: 12px;">Tel: 028.1234.5678</p>';
                invoiceHtml += '</div>';
                
                // Order info
                invoiceHtml += '<div style="margin-bottom: 15px;">';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
                invoiceHtml += '<span><strong>H√≥a ƒë∆°n:</strong></span><span>' + orderId + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
                invoiceHtml += '<span><strong>B√†n:</strong></span><span>' + table + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
                invoiceHtml += '<span><strong>Ng√†y:</strong></span><span>' + new Date().toLocaleDateString('vi-VN') + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
                invoiceHtml += '<span><strong>Gi·ªù:</strong></span><span>' + new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'}) + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 5px;">';
                invoiceHtml += '<span><strong>Tr·∫°ng th√°i:</strong></span><span style="color: #ff6b35; font-weight: bold;">CH∆ØA THANH TO√ÅN</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '</div>';
                
                // Items
                invoiceHtml += '<div style="border-top: 1px dashed #000; border-bottom: 1px dashed #000; padding: 10px 0; margin-bottom: 15px;">';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 3px;">';
                invoiceHtml += '<span>2x Ph·ªü b√≤ t√°i</span><span>' + formatCurrency(120000) + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 3px;">';
                invoiceHtml += '<span>1x C∆°m rang th·∫≠p c·∫©m</span><span>' + formatCurrency(35000) + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 3px;">';
                invoiceHtml += '<span>2x Tr√† ƒë√°</span><span>' + formatCurrency(10000) + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '</div>';
                
                // Totals
                invoiceHtml += '<div style="margin-bottom: 15px;">';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 3px;">';
                invoiceHtml += '<span>T·ªïng ti·ªÅn h√†ng:</span><span>' + formatCurrency(subtotal) + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; margin-bottom: 3px;">';
                invoiceHtml += '<span>Thu·∫ø VAT (8%):</span><span>' + formatCurrency(taxAmount) + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '</div>';
                
                // Final total
                invoiceHtml += '<div style="border-top: 2px solid #000; padding-top: 10px; margin-bottom: 15px;">';
                invoiceHtml += '<div style="display: flex; justify-content: space-between; font-size: 16px; font-weight: bold;">';
                invoiceHtml += '<span>TH√ÄNH TI·ªÄN:</span><span>' + formatCurrency(finalTotal) + '</span>';
                invoiceHtml += '</div>';
                invoiceHtml += '</div>';
                
                // QR Code section
                invoiceHtml += '<div style="text-align: center; border-top: 1px dashed #000; padding-top: 15px; margin-bottom: 15px;">';
                invoiceHtml += '<p style="margin: 0 0 10px 0; font-size: 12px; font-weight: bold;">M√É QR THANH TO√ÅN PAYOS</p>';
                invoiceHtml += '<img src="' + qrUrl + '" ';
                invoiceHtml += 'style="width: 140px; height: 140px; margin: 10px auto; display: block; border: 1px solid #ddd; border-radius: 8px;" ';
                invoiceHtml += 'alt="PayOS QR Code thanh to√°n" ';
                invoiceHtml += 'onload="debugLog(\'‚úÖ QR Image loaded successfully\')" ';
                invoiceHtml += 'onerror="debugLog(\'‚ùå QR Image failed to load: \' + this.src); this.style.backgroundColor=\'#f8f9fa\'; this.style.border=\'2px dashed #ccc\'; this.alt=\'QR Load Error\';">';
                invoiceHtml += '<p style="margin: 10px 0 5px 0; font-size: 10px; color: #666;">Qu√©t m√£ QR ƒë·ªÉ thanh to√°n qua VietQR</p>';
                invoiceHtml += '<p style="margin: 0; font-size: 9px; color: #999;">Ng√¢n h√†ng: Vietcombank | TK: ...304746708</p>';
                invoiceHtml += '</div>';
                invoiceHtml += '</div>';
                
                // Footer
                invoiceHtml += '<div style="text-align: center; font-size: 12px; border-top: 1px dashed #000; padding-top: 10px;">';
                invoiceHtml += '<p style="margin: 0 0 5px 0;"><strong>C·∫¢M ∆†N QU√ù KH√ÅCH!</strong></p>';
                invoiceHtml += '<p style="margin: 0;">H·∫πn g·∫∑p l·∫°i!</p>';
                invoiceHtml += '<p style="margin: 10px 0 0 0; font-size: 10px; color: #ff6b35;">* ƒê√¢y l√† h√≥a ƒë∆°n t·∫°m. Vui l√≤ng thanh to√°n ƒë·ªÉ ho√†n t·∫•t.</p>';
                invoiceHtml += '</div>';
                
                document.getElementById('invoicePreview').innerHTML = invoiceHtml;
                document.getElementById('invoiceSection').style.display = 'block';
                
                debugLog('‚úÖ Invoice generated successfully');
                
            } catch (error) {
                debugLog('‚ùå Error generating invoice: ' + error.message);
                alert('L·ªói t·∫°o h√≥a ƒë∆°n: ' + error.message);
            }
        }

        // Print function
        function printInvoice() {
            debugLog('Starting print...');
            try {
                window.print();
                debugLog('‚úÖ Print dialog opened');
            } catch (error) {
                debugLog('‚ùå Error printing: ' + error.message);
                alert('L·ªói in h√≥a ƒë∆°n: ' + error.message);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ QR Demo Simple version loaded');
        });
    </script>
</body>
</html>