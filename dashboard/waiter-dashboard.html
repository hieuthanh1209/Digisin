<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph·ª•c v·ª• - H·ªá th·ªëng Qu·∫£n l√Ω Nh√† h√†ng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="waiter-styles.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>

<body>
    <div class="d-flex vh-100">
        <!-- Sidebar -->
        <div class="sidebar bg-white shadow-lg border-end" style="width: 300px;">
            <div class="p-4 border-bottom">
                <h1 class="h3 fw-bold text-dark mb-1">Ph·ª•c v·ª•</h1>
                <p class="text-muted mb-0">Qu·∫£n l√Ω b√†n v√† Order</p>
            </div>
            <nav class="p-3">
                <button class="nav-button btn w-100 text-start mb-3 p-3" onclick="location.href='../index.html'">
                    üè† <span class="ms-2">Trang ch·ªß</span>
                </button> <button class="nav-button nav-button-active btn w-100 text-start mb-3 p-3"
                    id="tablesManagementBtn" onclick="switchToTablesManagement()">
                    üçΩÔ∏è <span class="ms-2">Qu·∫£n l√Ω b√†n</span>
                </button>
                <button class="nav-button btn w-100 text-start mb-3 p-3" id="ordersManagementBtn"
                    onclick="switchToOrdersManagement()">
                    üìù <span class="ms-2">Qu·∫£n l√Ω Order</span>
                </button>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-fill d-flex flex-column"> <!-- Header -->
            <div class="bg-white shadow-sm border-bottom p-4 d-flex align-items-center justify-content-between">
                <h2 class="h4 mb-0" id="pageTitle">Qu·∫£n l√Ω b√†n</h2>
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <small class="text-muted">Xin ch√†o, <span class="fw-medium" id="staffName">ƒêang
                                t·∫£i...</span></small>
                        <small class="text-muted d-block" id="staffRole">Nh√¢n vi√™n ph·ª•c v·ª•</small>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-link p-0 text-dark" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <div class="d-flex align-items-center">
                                <div class="bg-secondary rounded-circle me-2 d-flex align-items-center justify-content-center"
                                    style="width: 40px; height: 40px;">
                                    <i data-lucide="user" class="text-white" style="width: 20px; height: 20px;"></i>
                                </div>
                                <i data-lucide="chevron-down" style="width: 16px; height: 16px;"></i>
                            </div>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end shadow">
                            <li class="px-3 py-2">
                                <div class="text-muted small">Email</div>
                                <div class="fw-medium" id="staffEmail">loading@email.com</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <button class="dropdown-item text-danger" type="button" onclick="handleLogout()">
                                    <i data-lucide="log-out" class="me-2" style="width: 16px; height: 16px;"></i>
                                    ƒêƒÉng xu·∫•t
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div><!-- Dashboard -->
            <div class="flex-fill p-4 bg-light overflow-auto" id="tablesManagement">
                <!-- Stats Cards -->
                <div class="row g-4 mb-4">
                    <div class="col-lg-4 col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <p class="text-muted mb-1 small">B√†n tr·ªëng</p>
                                        <h3 class="display-6 fw-bold mb-0" id="emptyTables">0</h3>
                                    </div>
                                    <div class="bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i data-lucide="check-circle-2" class="text-success"
                                            style="width: 24px; height: 24px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <p class="text-muted mb-1 small">ƒêang ph·ª•c v·ª•</p>
                                        <h3 class="display-6 fw-bold mb-0" id="occupiedTables">0</h3>
                                    </div>
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i data-lucide="users" class="text-primary"
                                            style="width: 24px; height: 24px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <p class="text-muted mb-1 small">T·ªïng s·ªë b√†n</p>
                                        <h3 class="display-6 fw-bold mb-0" id="totalTables">12</h3>
                                    </div>
                                    <div class="bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i data-lucide="grid-3x3" class="text-info"
                                            style="width: 24px; height: 24px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table Grid -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">S∆° ƒë·ªì b√†n</h5>
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex gap-3">
                                <span class="badge bg-success">Tr·ªëng</span>
                                <span class="badge bg-primary">ƒêang ph·ª•c v·ª•</span>
                                <span class="badge bg-warning">Ch·ªù thanh to√°n</span>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-warning btn-sm" onclick="showMergeTablesModal()">
                                    <i data-lucide="link" style="width: 16px; height: 16px;"></i>
                                    Gh√©p b√†n
                                </button>
                                <button class="btn btn-info btn-sm" onclick="showSplitTablesModal()">
                                    <i data-lucide="unlink" style="width: 16px; height: 16px;"></i>
                                    T√°ch b√†n
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="showCreateTableModal()">
                                    <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
                                    T·∫°o b√†n
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-4" id="tablesGrid">
                            <!-- Tables will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Management -->
            <div class="flex-fill p-4 bg-light overflow-auto d-none" id="ordersManagement">
                <!-- Orders Stats -->
                <div class="row g-4 mb-4">
                    <div class="col-xl-3 col-lg-6 col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <p class="text-muted mb-1 small">Ch·ªù x√°c nh·∫≠n</p>
                                        <h3 class="display-6 fw-bold mb-0" id="pendingOrders">0</h3>
                                    </div>
                                    <div class="bg-warning bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i data-lucide="clock" class="text-warning"
                                            style="width: 24px; height: 24px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <p class="text-muted mb-1 small">ƒêang n·∫•u</p>
                                        <h3 class="display-6 fw-bold mb-0" id="cookingOrders">0</h3>
                                    </div>
                                    <div class="bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i data-lucide="chef-hat" class="text-info"
                                            style="width: 24px; height: 24px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <p class="text-muted mb-1 small">S·∫µn s√†ng</p>
                                        <h3 class="display-6 fw-bold mb-0" id="readyOrders">0</h3>
                                    </div>
                                    <div class="bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i data-lucide="check-circle-2" class="text-success"
                                            style="width: 24px; height: 24px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <p class="text-muted mb-1 small">Ho√†n th√†nh</p>
                                        <h3 class="display-6 fw-bold mb-0" id="completedOrders">0</h3>
                                    </div>
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px;">
                                        <i data-lucide="check-check" class="text-primary"
                                            style="width: 24px; height: 24px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Filter and Actions -->
                <div class="row g-4 mb-4">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <div class="row g-3 align-items-center">
                                    <div class="col-md-4">
                                        <label class="form-label mb-1 small fw-medium">L·ªçc theo tr·∫°ng th√°i</label>
                                        <select class="form-select" id="orderStatusFilter">
                                            <option value="all">T·∫•t c·∫£</option>
                                            <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
                                            <option value="cooking">ƒêang n·∫•u</option>
                                            <option value="ready">S·∫µn s√†ng</option>
                                            <option value="completed">Ho√†n th√†nh</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label mb-1 small fw-medium">L·ªçc theo b√†n</label>
                                        <select class="form-select" id="orderTableFilter">
                                            <option value="all">T·∫•t c·∫£ b√†n</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label mb-1 small fw-medium">T√¨m ki·∫øm</label>
                                        <div class="input-group">
                                            <span class="input-group-text">
                                                <i data-lucide="search" style="width: 16px; height: 16px;"></i>
                                            </span>
                                            <input type="text" class="form-control" placeholder="T√¨m order..."
                                                id="orderSearch">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body d-flex align-items-center">
                                <button class="btn btn-primary w-100" onclick="showCreateOrderModal()">
                                    <i data-lucide="plus" style="width: 18px; height: 18px;"></i>
                                    T·∫°o Order m·ªõi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders List -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Danh s√°ch Order</h5>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-secondary btn-sm" onclick="refreshOrders()">
                                <i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>
                                L√†m m·ªõi
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="px-4 py-3">Order ID</th>
                                        <th class="py-3">B√†n</th>
                                        <th class="py-3">Th·ªùi gian</th>
                                        <th class="py-3">M√≥n ƒÉn</th>
                                        <th class="py-3">T·ªïng ti·ªÅn</th>
                                        <th class="py-3">Tr·∫°ng th√°i</th>
                                        <th class="py-3">Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTableBody">
                                    <!-- Orders will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="p-4 text-center d-none" id="noOrdersMessage">
                            <div class="text-muted">
                                <i data-lucide="clipboard-list" style="width: 48px; height: 48px;"
                                    class="mb-3 opacity-50"></i>
                                <p class="mb-0">Ch∆∞a c√≥ order n√†o</p>
                                <small>T·∫°o order m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Modal - Redesigned -->
    <div class="modal fade" id="orderModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-xl-down modal-xxl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-gradient-primary text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i data-lucide="utensils" class="text-white" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0">T·∫°o Order</h5>
                            <small class="opacity-75">
                                <i data-lucide="map-pin" style="width: 14px; height: 14px;"></i>
                                <span id="modalTableName" class="ms-1"></span>
                            </small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-0">
                    <div class="row g-0 h-100">
                        <!-- Categories Sidebar -->
                        <div class="col-lg-3 col-md-12 order-1 order-lg-1 bg-light border-end">
                            <div class="p-4 border-bottom bg-white">
                                <h6 class="fw-bold mb-0 text-primary">
                                    <i data-lucide="grid-3x3" class="me-2" style="width: 18px; height: 18px;"></i>
                                    Danh m·ª•c m√≥n ƒÉn
                                </h6>
                            </div>
                            <div class="p-3">
                                <div class="category-buttons" id="menuCategories">
                                    <button type="button" class="category-btn active" data-category="all">
                                        <i data-lucide="utensils" style="width: 16px; height: 16px;"></i>
                                        <span>T·∫•t c·∫£ m√≥n</span>
                                        <div class="category-count">28</div>
                                    </button>
                                    <button type="button" class="category-btn" data-category="noodles">
                                        <i data-lucide="bowl" style="width: 16px; height: 16px;"></i>
                                        <span>M√¨ & Ph·ªü</span>
                                        <div class="category-count">7</div>
                                    </button>
                                    <button type="button" class="category-btn" data-category="rice">
                                        <i data-lucide="wheat" style="width: 16px; height: 16px;"></i>
                                        <span>C∆°m</span>
                                        <div class="category-count">6</div>
                                    </button>
                                    <button type="button" class="category-btn" data-category="drinks">
                                        <i data-lucide="coffee" style="width: 16px; height: 16px;"></i>
                                        <span>ƒê·ªì u·ªëng</span>
                                        <div class="category-count">9</div>
                                    </button>
                                    <button type="button" class="category-btn" data-category="snacks">
                                        <i data-lucide="cookie" style="width: 16px; height: 16px;"></i>
                                        <span>Tr√°ng mi·ªáng</span>
                                        <div class="category-count">6</div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Menu Items -->
                        <div class="col-lg-6 col-md-7 order-2 order-lg-2 bg-white">
                            <div class="p-4 border-bottom">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="fw-bold mb-0 text-primary">
                                        <i data-lucide="chef-hat" class="me-2" style="width: 18px; height: 18px;"></i>
                                        Th·ª±c ƒë∆°n
                                    </h6>
                                    <div class="search-box">
                                        <input type="text" 
                                               placeholder="T√¨m m√≥n ƒÉn..." 
                                               id="menuSearch">
                                        <button type="button" class="clear-search" id="clearSearch" title="X√≥a t√¨m ki·∫øm">
                                            <i data-lucide="x" style="width: 14px; height: 14px;"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="menu-content" id="menuItems">
                                <!-- Menu items will be rendered here -->
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="col-lg-3 col-md-5 order-3 order-lg-3 bg-gradient-light">
                            <div class="p-4 border-bottom bg-primary text-white">
                                <h6 class="fw-bold mb-0">
                                    <i data-lucide="shopping-cart" class="me-2" style="width: 18px; height: 18px;"></i>
                                    Order
                                    <span class="badge bg-white text-primary ms-2" id="orderItemCount">0</span>
                                </h6>
                            </div>

                            <div class="order-summary-new">

                                <div class="order-list" id="orderItems">
                                    <div class="empty-order">
                                        <div class="text-center py-5">
                                            <div class="empty-cart-icon mb-3">
                                                <i data-lucide="shopping-cart" style="width: 48px; height: 48px;"></i>
                                            </div>
                                            <p class="text-muted mb-0">Ch∆∞a c√≥ m√≥n n√†o</p>
                                            <small class="text-muted">Ch·ªçn m√≥n t·ª´ th·ª±c ƒë∆°n</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Order Notes -->
                                <div class="order-notes">
                                    <label class="form-label fw-semibold">
                                        <i data-lucide="file-text" style="width: 16px; height: 16px;"></i>
                                        Ghi ch√∫ Order
                                    </label>
                                    <textarea class="form-control" id="orderNotes" rows="3"
                                        placeholder="Ghi ch√∫ ƒë·∫∑c bi·ªát (kh√¥ng cay, √≠t ƒë∆∞·ªùng, v.v.)"></textarea>
                                </div>

                                <!-- Order Total -->
                                <div class="order-total-section">
                                    <div class="total-breakdown">
                                        <div class="d-flex justify-content-between">
                                            <span>T·∫°m t√≠nh:</span>
                                            <span id="subtotal">0‚Ç´</span>
                                        </div>
                                        <div class="d-flex justify-content-between text-muted small">
                                            <span>VAT (10%):</span>
                                            <span id="vatAmount">0‚Ç´</span>
                                        </div>
                                        <hr class="my-2">
                                        <div class="d-flex justify-content-between fw-bold h5">
                                            <span>T·ªïng c·ªông:</span>
                                            <span id="orderTotal" class="text-primary">0‚Ç´</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer bg-gradient-light border-0 p-4">
                    <div class="d-flex gap-3 w-100">
                        <button type="button" class="btn btn-outline-secondary flex-fill btn-cancel" data-bs-dismiss="modal">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                            <span class="ms-2">H·ªßy</span>
                        </button> 
                        <button type="button" class="btn btn-primary flex-fill btn-submit" id="submitOrder"
                            onclick="submitOrder()" disabled>
                            <i data-lucide="check" style="width: 16px; height: 16px;"></i>
                            <span class="ms-2">T·∫°o Order</span>
                            <div class="btn-loading d-none">
                                <div class="spinner-border spinner-border-sm ms-2" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Table Actions Modal -->
    <div class="modal fade" id="tableActionsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Thao t√°c b√†n - <span id="actionsTableName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-grid gap-3">
                        <button class="btn btn-success btn-lg" onclick="cleanTable()">
                            <i data-lucide="check-circle-2" style="width: 20px; height: 20px;"></i>
                            D·ªçn b√†n xong
                        </button>
                        <button class="btn btn-primary btn-lg" onclick="addOrder()">
                            <i data-lucide="plus-circle" style="width: 20px; height: 20px;"></i>
                            Th√™m m√≥n
                        </button>
                        <button class="btn btn-secondary btn-lg" id="splitTableBtn" onclick="splitMergedTable()"
                            style="display: none;">
                            <i data-lucide="unlink" style="width: 20px; height: 20px;"></i>
                            T√°ch b√†n
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="forceCleanTable()" title="D·ªçn b√†n ngay l·∫≠p t·ª©c (kh√¥ng ki·ªÉm tra thanh to√°n)">
                            <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                            Force Clean
                        </button>
                        <button class="btn btn-warning btn-lg" onclick="callWaiter()">
                            <i data-lucide="bell" style="width: 20px; height: 20px;"></i>
                            G·ªçi ph·ª•c v·ª•
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i data-lucide="check-circle-2" style="width: 20px; height: 20px;"></i>
                        Th√†nh c√¥ng
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <div class="mb-3">
                        <i data-lucide="check-circle-2" class="text-success" style="width: 64px; height: 64px;"></i>
                    </div>
                    <h6 class="fw-bold mb-2" id="successTitle">Order ƒë√£ ƒë∆∞·ª£c t·∫°o!</h6>
                    <p class="text-muted mb-0" id="successMessage">Order ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn b·∫øp.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i data-lucide="clipboard-list" class="text-white" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0">Chi ti·∫øt Order</h5>
                            <small class="opacity-75" id="orderDetailSubtitle"></small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-0">
                    <div class="row g-0">
                        <!-- Order Info -->
                        <div class="col-12">
                            <div class="p-4 border-bottom bg-light">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted mb-1">Order ID</label>
                                        <div class="fw-bold" id="detailOrderId">#ORD-001</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted mb-1">B√†n s·ªë</label>
                                        <div class="fw-bold" id="detailTableNumber">1</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted mb-1">Th·ªùi gian t·∫°o</label>
                                        <div class="fw-bold" id="detailOrderTime">14:30</div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted mb-1">Tr·∫°ng th√°i</label>
                                        <div id="detailOrderStatus">
                                            <span class="badge bg-warning">Ch·ªù x√°c nh·∫≠n</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="col-12">
                            <div class="p-4 border-bottom">
                                <h6 class="fw-bold mb-3 text-primary">
                                    <i data-lucide="utensils" class="me-2" style="width: 18px; height: 18px;"></i>
                                    M√≥n ƒÉn ƒë√£ order
                                </h6>
                                <div id="detailOrderItems">
                                    <!-- Order items will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <!-- Order Notes -->
                        <div class="col-12">
                            <div class="p-4 border-bottom">
                                <h6 class="fw-bold mb-3 text-primary">
                                    <i data-lucide="file-text" class="me-2" style="width: 18px; height: 18px;"></i>
                                    Ghi ch√∫
                                </h6>
                                <div id="detailOrderNotes" class="text-muted">
                                    Kh√¥ng c√≥ ghi ch√∫
                                </div>
                            </div>
                        </div>

                        <!-- Order Total -->
                        <div class="col-12">
                            <div class="p-4 bg-light">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>T·∫°m t√≠nh:</span>
                                            <span id="detailSubtotal">0‚Ç´</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2 text-muted small">
                                            <span>VAT (10%):</span>
                                            <span id="detailVat">0‚Ç´</span>
                                        </div>
                                        <hr class="my-2">
                                        <div class="d-flex justify-content-between fw-bold h5">
                                            <span>T·ªïng c·ªông:</span>
                                            <span id="detailTotal" class="text-primary">0‚Ç´</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer bg-light border-0 p-4">
                    <div class="d-flex gap-3 w-100">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                            ƒê√≥ng
                        </button>
                        <button type="button" class="btn btn-warning" id="editOrderBtn" onclick="editOrder()">
                            <i data-lucide="edit" style="width: 16px; height: 16px;"></i>
                            Ch·ªânh s·ª≠a
                        </button>
                        <button type="button" class="btn btn-success" id="updateOrderStatusBtn"
                            onclick="updateOrderStatus()">
                            <i data-lucide="check" style="width: 16px; height: 16px;"></i>
                            C·∫≠p nh·∫≠t tr·∫°ng th√°i
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Order for Table Modal -->
    <div class="modal fade" id="createOrderModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i data-lucide="plus-circle" style="width: 20px; height: 20px;"></i>
                        T·∫°o Order m·ªõi
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-medium">Ch·ªçn b√†n</label>
                        <select class="form-select" id="selectTableForOrder">
                            <option value="">-- Ch·ªçn b√†n --</option>
                        </select>
                    </div>
                    <div class="alert alert-info">
                        <i data-lucide="info" style="width: 16px; height: 16px;"></i>
                        Sau khi ch·ªçn b√†n, b·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn m√†n h√¨nh t·∫°o order chi ti·∫øt.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" onclick="proceedToCreateOrder()">
                        <i data-lucide="arrow-right" style="width: 16px; height: 16px;"></i>
                        Ti·∫øp t·ª•c
                    </button>
                </div>
            </div>
        </div>
    </div> <!-- Create Table Modal -->
    <div class="modal fade" id="createTableModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i data-lucide="plus-circle" class="text-white" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0">T·∫°o b√†n m·ªõi</h5>
                            <small class="opacity-75">Th√™m b√†n v√†o s∆° ƒë·ªì nh√† h√†ng</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-4">
                    <form id="createTableForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">
                                    <i data-lucide="hash" style="width: 16px; height: 16px;"></i>
                                    S·ªë b√†n *
                                </label>
                                <input type="number" class="form-control" id="tableNumber" min="1" max="999"
                                    placeholder="VD: 6" required>
                                <div class="form-text">S·ªë b√†n ph·∫£i l√† duy nh·∫•t. S·∫Ω t·∫°o ID: T001, T002...</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">
                                    <i data-lucide="users" style="width: 16px; height: 16px;"></i>
                                    S·ªë ch·ªó ng·ªìi *
                                </label>
                                <select class="form-select" id="tableCapacity" required>
                                    <option value="">-- Ch·ªçn s·ªë ch·ªó --</option>
                                    <option value="2">2 ng∆∞·ªùi</option>
                                    <option value="4">4 ng∆∞·ªùi</option>
                                    <option value="6">6 ng∆∞·ªùi</option>
                                    <option value="8">8 ng∆∞·ªùi</option>
                                    <option value="10">10 ng∆∞·ªùi</option>
                                    <option value="12">12 ng∆∞·ªùi</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-medium">
                                    <i data-lucide="map-pin" style="width: 16px; height: 16px;"></i>
                                    V·ªã tr√≠
                                </label>
                                <select class="form-select" id="tableLocation">
                                    <option value="indoor">Trong nh√†</option>
                                    <option value="outdoor">Ngo√†i tr·ªùi</option>
                                    <option value="vip">Khu VIP</option>
                                    <option value="private">Ph√≤ng ri√™ng</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-medium">
                                    <i data-lucide="file-text" style="width: 16px; height: 16px;"></i>
                                    Ghi ch√∫
                                </label>
                                <textarea class="form-control" id="tableNotes" rows="3"
                                    placeholder="Ghi ch√∫ ƒë·∫∑c bi·ªát v·ªÅ b√†n (g·∫ßn c·ª≠a s·ªï, view ƒë·∫πp, v.v.)"></textarea>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3">
                            <i data-lucide="info" style="width: 16px; height: 16px;"></i>
                            <strong>L∆∞u √Ω:</strong> B√†n m·ªõi s·∫Ω ƒë∆∞·ª£c t·∫°o v·ªõi tr·∫°ng th√°i "C√≥ s·∫µn" v√† s·∫µn s√†ng ph·ª•c v·ª•
                            kh√°ch h√†ng.
                        </div>
                    </form>
                </div>

                <div class="modal-footer bg-light border-0 p-4">
                    <div class="d-flex gap-3 w-100">
                        <button type="button" class="btn btn-outline-secondary flex-fill" data-bs-dismiss="modal">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                            H·ªßy
                        </button>
                        <button type="button" class="btn btn-primary flex-fill" onclick="createNewTable()">
                            <i data-lucide="check" style="width: 16px; height: 16px;"></i>
                            T·∫°o b√†n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Merge Tables Modal -->
    <div class="modal fade" id="mergeTablesModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-warning text-dark border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-dark bg-opacity-20 rounded-circle p-2 me-3">
                            <i data-lucide="link" class="text-dark" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0">Gh√©p b√†n</h5>
                            <small class="opacity-75">G·ªôp nhi·ªÅu b√†n th√†nh m·ªôt b√†n l·ªõn</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-4">
                    <form id="mergeTablesForm">
                        <div class="row g-4">
                            <!-- Step 1: Select Main Table -->
                            <div class="col-12">
                                <h6 class="fw-bold text-primary mb-3">
                                    <i data-lucide="star" style="width: 18px; height: 18px;"></i>
                                    B∆∞·ªõc 1: Ch·ªçn b√†n ch√≠nh
                                </h6>
                                <div class="alert alert-info">
                                    <i data-lucide="info" style="width: 16px; height: 16px;"></i>
                                    B√†n ch√≠nh s·∫Ω gi·ªØ nguy√™n s·ªë b√†n v√† order. C√°c b√†n kh√°c s·∫Ω ƒë∆∞·ª£c g·ªôp v√†o.
                                </div>
                                <select class="form-select" id="mainTable" required>
                                    <option value="">-- Ch·ªçn b√†n ch√≠nh --</option>
                                </select>
                            </div>

                            <!-- Step 2: Select Tables to Merge -->
                            <div class="col-12">
                                <h6 class="fw-bold text-primary mb-3">
                                    <i data-lucide="users" style="width: 18px; height: 18px;"></i>
                                    B∆∞·ªõc 2: Ch·ªçn c√°c b√†n c·∫ßn gh√©p
                                </h6>
                                <div class="alert alert-warning">
                                    <i data-lucide="alert-triangle" style="width: 16px; height: 16px;"></i>
                                    Ch·ªâ c√≥ th·ªÉ gh√©p c√°c b√†n tr·ªëng. C√°c b√†n ƒëang ph·ª•c v·ª• c·∫ßn ho√†n th√†nh order tr∆∞·ªõc.
                                </div>
                                <div class="tables-selection" id="tablesSelection">
                                    <!-- Available tables will be rendered here -->
                                </div>
                            </div>

                            <!-- Step 3: Merged Table Info -->
                            <div class="col-12" id="mergedTableInfo" style="display: none;">
                                <h6 class="fw-bold text-primary mb-3">
                                    <i data-lucide="info" style="width: 18px; height: 18px;"></i>
                                    Th√¥ng tin b√†n sau khi gh√©p
                                </h6>
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label small text-muted mb-1">T√™n b√†n</label>
                                                <div class="fw-bold" id="mergedTableName">-</div>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label small text-muted mb-1">T·ªïng s·ª©c ch·ª©a</label>
                                                <div class="fw-bold" id="mergedTableCapacity">0 ng∆∞·ªùi</div>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label small text-muted mb-1">S·ªë b√†n gh√©p</label>
                                                <div class="fw-bold" id="mergedTableCount">0 b√†n</div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <label class="form-label small text-muted mb-1">Danh s√°ch b√†n gh√©p</label>
                                            <div id="mergedTablesList" class="d-flex flex-wrap gap-1">
                                                <!-- Merged tables badges will be shown here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Notes -->
                            <div class="col-12">
                                <label class="form-label fw-medium">
                                    <i data-lucide="file-text" style="width: 16px; height: 16px;"></i>
                                    Ghi ch√∫ gh√©p b√†n
                                </label>
                                <textarea class="form-control" id="mergeNotes" rows="3"
                                    placeholder="Ghi ch√∫ l√Ω do gh√©p b√†n (gia ƒë√¨nh l·ªõn, s·ª± ki·ªán ƒë·∫∑c bi·ªát, v.v.)"></textarea>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="modal-footer bg-light border-0 p-4">
                    <div class="d-flex gap-3 w-100">
                        <button type="button" class="btn btn-outline-secondary flex-fill" data-bs-dismiss="modal">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                            H·ªßy
                        </button>
                        <button type="button" class="btn btn-warning flex-fill" id="mergTablesBtn"
                            onclick="mergeTables()" disabled>
                            <i data-lucide="link" style="width: 16px; height: 16px;"></i>
                            Gh√©p b√†n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Merge Confirmation Modal -->
    <div class="modal fade" id="mergeConfirmationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-warning text-dark border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-dark bg-opacity-20 rounded-circle p-2 me-3">
                            <i data-lucide="alert-triangle" class="text-dark" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0">X√°c nh·∫≠n gh√©p b√†n</h5>
                            <small class="opacity-75">Vui l√≤ng ki·ªÉm tra th√¥ng tin tr∆∞·ªõc khi gh√©p</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-4">
                    <div class="alert alert-warning">
                        <i data-lucide="info" style="width: 16px; height: 16px;"></i>
                        <strong>L∆∞u √Ω:</strong> Sau khi gh√©p b√†n, c√°c b√†n ƒë∆∞·ª£c ch·ªçn s·∫Ω b·ªã x√≥a v√† kh√¥ng th·ªÉ kh√¥i ph·ª•c
                        ri√™ng l·∫ª. Ch·ªâ c√≥ th·ªÉ t√°ch to√†n b·ªô b√†n gh√©p.
                    </div>

                    <div id="mergeConfirmationDetails">
                        <!-- Merge details will be populated here -->
                    </div>
                </div>

                <div class="modal-footer bg-light border-0 p-4">
                    <div class="d-flex gap-3 w-100">
                        <button type="button" class="btn btn-outline-secondary flex-fill" data-bs-dismiss="modal">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                            H·ªßy
                        </button>
                        <button type="button" class="btn btn-warning flex-fill" id="confirmMergeBtn"
                            onclick="confirmMergeTables()">
                            <i data-lucide="check" style="width: 16px; height: 16px;"></i>
                            X√°c nh·∫≠n gh√©p b√†n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Split Tables Modal -->
    <div class="modal fade" id="splitTablesModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-info text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i data-lucide="unlink" class="text-white" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0">T√°ch b√†n</h5>
                            <small class="opacity-75">T√°ch b√†n gh√©p th√†nh c√°c b√†n ri√™ng bi·ªát</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-4">
                    <form id="splitTablesForm">
                        <div class="row g-4">
                            <!-- Step 1: Select Merged Table -->
                            <div class="col-12">
                                <h6 class="fw-bold text-primary mb-3">
                                    <i data-lucide="target" style="width: 18px; height: 18px;"></i>
                                    B∆∞·ªõc 1: Ch·ªçn b√†n gh√©p c·∫ßn t√°ch
                                </h6>
                                <div class="alert alert-info">
                                    <i data-lucide="info" style="width: 16px; height: 16px;"></i>
                                    Ch·ªâ c√≥ th·ªÉ t√°ch c√°c b√†n ƒë√£ ƒë∆∞·ª£c gh√©p tr∆∞·ªõc ƒë√≥ v√† ƒëang tr·ªëng (kh√¥ng c√≥ order ƒëang x·ª≠
                                    l√Ω).
                                </div>
                                <select class="form-select" id="tableToSplit" required>
                                    <option value="">-- Ch·ªçn b√†n gh√©p c·∫ßn t√°ch --</option>
                                </select>
                            </div>

                            <!-- Step 2: Split Configuration -->
                            <div class="col-12" id="splitConfiguration" style="display: none;">
                                <h6 class="fw-bold text-primary mb-3">
                                    <i data-lucide="settings" style="width: 18px; height: 18px;"></i>
                                    B∆∞·ªõc 2: C·∫•u h√¨nh t√°ch b√†n
                                </h6>

                                <!-- Current Table Info -->
                                <div class="card bg-light mb-3">
                                    <div class="card-body">
                                        <h6 class="card-title text-success mb-3">Th√¥ng tin b√†n hi·ªán t·∫°i</h6>
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <label class="form-label small text-muted mb-1">T√™n b√†n</label>
                                                <div class="fw-bold" id="currentTableName">-</div>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small text-muted mb-1">S·ª©c ch·ª©a</label>
                                                <div class="fw-bold" id="currentTableCapacity">0 ng∆∞·ªùi</div>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small text-muted mb-1">Tr·∫°ng th√°i</label>
                                                <div class="fw-bold" id="currentTableStatus">-</div>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label small text-muted mb-1">B√†n ƒë√£ gh√©p</label>
                                                <div class="fw-bold" id="mergedTablesCount">0 b√†n</div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <label class="form-label small text-muted mb-1">Danh s√°ch b√†n trong
                                                gh√©p</label>
                                            <div id="currentMergedTablesList" class="d-flex flex-wrap gap-1">
                                                <!-- Current merged tables badges will be shown here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Split Options -->
                                <div class="card border-warning">
                                    <div class="card-body">
                                        <h6 class="card-title text-warning mb-3">
                                            <i data-lucide="scissors" style="width: 18px; height: 18px;"></i>
                                            C·∫•u h√¨nh t√°ch b√†n
                                        </h6>

                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="splitOption"
                                                        id="splitCompletelyOption" value="completely" checked>
                                                    <label class="form-check-label fw-medium"
                                                        for="splitCompletelyOption">
                                                        <i data-lucide="grid-3x3"
                                                            style="width: 16px; height: 16px;"></i>
                                                        T√°ch ho√†n to√†n th√†nh c√°c b√†n ri√™ng bi·ªát
                                                    </label>
                                                    <div class="form-text">T√°ch th√†nh c√°c b√†n ƒë∆°n l·∫ª nh∆∞ ban ƒë·∫ßu</div>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="splitOption"
                                                        id="splitCustomOption" value="custom">
                                                    <label class="form-check-label fw-medium" for="splitCustomOption">
                                                        <i data-lucide="sliders" style="width: 16px; height: 16px;"></i>
                                                        T√°ch t√πy ch·ªânh (ch·ªçn b√†n c·ª• th·ªÉ)
                                                    </label>
                                                    <div class="form-text">Ch·ªçn b√†n n√†o s·∫Ω ƒë∆∞·ª£c t√°ch ra, gi·ªØ l·∫°i c√°c b√†n
                                                        kh√°c</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Custom Split Selection -->
                                        <div id="customSplitSelection" class="mt-3" style="display: none;">
                                            <label class="form-label fw-medium mb-2">Ch·ªçn b√†n c·∫ßn t√°ch ra:</label>
                                            <div id="tablesForCustomSplit" class="row g-2">
                                                <!-- Tables for custom split will be rendered here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: Preview Result -->
                            <div class="col-12" id="splitPreview" style="display: none;">
                                <h6 class="fw-bold text-primary mb-3">
                                    <i data-lucide="eye" style="width: 18px; height: 18px;"></i>
                                    B∆∞·ªõc 3: Xem tr∆∞·ªõc k·∫øt qu·∫£
                                </h6>
                                <div class="row g-3" id="splitPreviewContent">
                                    <!-- Split preview will be rendered here -->
                                </div>
                            </div>

                            <!-- Notes -->
                            <div class="col-12">
                                <label class="form-label fw-medium">
                                    <i data-lucide="file-text" style="width: 16px; height: 16px;"></i>
                                    Ghi ch√∫ t√°ch b√†n
                                </label>
                                <textarea class="form-control" id="splitNotes" rows="3"
                                    placeholder="Ghi ch√∫ l√Ω do t√°ch b√†n (kh√°ch y√™u c·∫ßu, thay ƒë·ªïi k·∫ø ho·∫°ch, v.v.)"></textarea>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="modal-footer bg-light border-0 p-4">
                    <div class="d-flex gap-3 w-100">
                        <button type="button" class="btn btn-outline-secondary flex-fill" data-bs-dismiss="modal">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                            H·ªßy
                        </button>
                        <button type="button" class="btn btn-info flex-fill" id="splitTablesBtn" onclick="splitTables()"
                            disabled>
                            <i data-lucide="unlink" style="width: 16px; height: 16px;"></i>
                            T√°ch b√†n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Split Confirmation Modal -->
    <div class="modal fade" id="splitConfirmationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-info text-white border-0">
                    <div class="d-flex align-items-center">
                        <div class="bg-white bg-opacity-20 rounded-circle p-2 me-3">
                            <i data-lucide="alert-triangle" class="text-white" style="width: 24px; height: 24px;"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0">X√°c nh·∫≠n t√°ch b√†n</h5>
                            <small class="opacity-75">Vui l√≤ng ki·ªÉm tra th√¥ng tin tr∆∞·ªõc khi t√°ch</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-4">
                    <div class="alert alert-warning">
                        <i data-lucide="info" style="width: 16px; height: 16px;"></i>
                        <strong>L∆∞u √Ω:</strong> Sau khi t√°ch b√†n, c√°c b√†n ƒë∆∞·ª£c t√°ch s·∫Ω tr·ªü th√†nh b√†n ri√™ng bi·ªát v√† c√≥
                        th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªôc l·∫≠p.
                    </div>

                    <div id="splitConfirmationDetails">
                        <!-- Split confirmation details will be populated here -->
                    </div>
                </div>

                <div class="modal-footer bg-light border-0 p-4">
                    <div class="d-flex gap-3 w-100">
                        <button type="button" class="btn btn-outline-secondary flex-fill" data-bs-dismiss="modal">
                            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                            H·ªßy
                        </button>
                        <button type="button" class="btn btn-info flex-fill" id="confirmSplitBtn"
                            onclick="confirmSplitTables()">
                            <i data-lucide="check" style="width: 16px; height: 16px;"></i>
                            X√°c nh·∫≠n t√°ch b√†n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="../src/utils/vat-manager.js"></script>
    <script src="../src/utils/vat-label-calculator.js"></script>
    <script type="module" src="waiter-script.js"></script>
    
    <script>
        // Function to update VAT labels based on system settings
        function updateVatLabels() {
            // Get current VAT rate
            let vatRate = 0.1; // Default 10%
            
            try {
                // Try to get from system settings
                const settings = JSON.parse(localStorage.getItem('systemSettings'));
                if (settings?.business?.vatRate) {
                    vatRate = settings.business.vatRate;
                }
                // Or try global function if available
                else if (typeof getCurrentVatRate === 'function') {
                    vatRate = getCurrentVatRate();
                }
            } catch (error) {
                console.warn('Could not get VAT rate from settings, using default:', error);
            }
            
            // Update all VAT labels by searching text content
            const spans = document.querySelectorAll('span');
            const vatPercentage = (vatRate * 100).toFixed(1);
            
            spans.forEach(span => {
                if (span.textContent.includes('VAT (') && span.textContent.includes('%):')) {
                    span.textContent = `VAT (${vatPercentage}%):`;
                }
            });
        }
        
        // Update VAT labels when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateVatLabels, 100);
        });
        
        // Update VAT labels when system settings change
        window.addEventListener('systemSettingsUpdated', function() {
            updateVatLabels();
        });
        
        // Make function globally available
        window.updateVatLabels = updateVatLabels;
    </script>
</body>

</html>