<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Táº¡o Ä‘Æ¡n hÃ ng áº£o - Firebase Setup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">ğŸš€ Táº¡o Ä‘Æ¡n hÃ ng áº£o cho test PayOS</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h5>ğŸ“‹ HÆ°á»›ng dáº«n:</h5>
                            <ol>
                                <li>Má»Ÿ <strong>F12 Developer Tools</strong></li>
                                <li>VÃ o tab <strong>Console</strong></li>
                                <li>Cháº¡y lá»‡nh: <code>createSampleOrders()</code></li>
                                <li>Äá»£i script táº¡o 5 Ä‘Æ¡n hÃ ng áº£o</li>
                                <li>Quay láº¡i <strong>cashier-dashboard.html</strong> Ä‘á»ƒ test PayOS</li>
                            </ol>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <button class="btn btn-success btn-lg w-100" onclick="createSampleOrders()">
                                    ğŸ“ Táº¡o 5 Ä‘Æ¡n hÃ ng áº£o
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-info btn-lg w-100" onclick="window.open('../dashboard/cashier-dashboard.html', '_blank')">
                                    ğŸ’° Má»Ÿ Cashier Dashboard
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5>ğŸ“Š ÄÆ¡n hÃ ng sáº½ Ä‘Æ°á»£c táº¡o:</h5>
                            <ul class="list-group">
                                <li class="list-group-item">âœ… Tráº¡ng thÃ¡i: <code>completed</code> (hoÃ n thÃ nh)</li>
                                <li class="list-group-item">ğŸ’³ Payment Status: <code>null</code> (chá» thanh toÃ¡n)</li>
                                <li class="list-group-item">ğŸ½ï¸ MÃ³n Äƒn: 2-5 mÃ³n ngáº«u nhiÃªn</li>
                                <li class="list-group-item">ğŸ  BÃ n: BÃ n 1-8 ngáº«u nhiÃªn</li>
                                <li class="list-group-item">ğŸ’° Tá»•ng tiá»n: 50,000â‚« - 300,000â‚«</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <h5>ğŸ§ª Test PayOS:</h5>
                            <ol>
                                <li>Sau khi táº¡o Ä‘Æ¡n hÃ ng, má»Ÿ <strong>Cashier Dashboard</strong></li>
                                <li>Chá»n Ä‘Æ¡n hÃ ng vÃ  nháº¥n <strong>"Thanh toÃ¡n"</strong></li>
                                <li>Chá»n phÆ°Æ¡ng thá»©c <strong>"PayOS"</strong></li>
                                <li>Test thanh toÃ¡n vá»›i server PayOS</li>
                            </ol>
                        </div>
                    </div>
                    <div class="card-footer text-muted">
                        <small>ğŸ’¡ Tip: Má»Ÿ Console (F12) Ä‘á»ƒ xem chi tiáº¿t quÃ¡ trÃ¬nh táº¡o Ä‘Æ¡n hÃ ng</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Console Output -->
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ“± Console Output</h5>
                    </div>
                    <div class="card-body">
                        <div id="console-output" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 200px; font-family: monospace;">
                            <div class="text-muted">Console output sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import and setup
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            Timestamp,
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import firebaseConfig from "../config/firebase-config.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Console output handler
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;

        function addToOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-danger' : (type === 'success' ? 'text-success' : 'text-dark');
            const div = document.createElement('div');
            div.className = color;
            div.innerHTML = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput(args.join(' '), 'error');
        };

        // Sample data
        const sampleMenuItems = [
            { name: "Phá»Ÿ bÃ² tÃ¡i", price: 65000, category: "MÃ³n chÃ­nh" },
            { name: "CÆ¡m gÃ  xá»‘i má»¡", price: 55000, category: "MÃ³n chÃ­nh" },
            { name: "BÃ¡nh mÃ¬ thá»‹t nÆ°á»›ng", price: 25000, category: "MÃ³n phá»¥" },
            { name: "BÃºn bÃ² Huáº¿", price: 60000, category: "MÃ³n chÃ­nh" },
            { name: "Gá»i cuá»‘n tÃ´m thá»‹t", price: 35000, category: "Khai vá»‹" },
            { name: "BÃ¡nh flan", price: 25000, category: "TrÃ¡ng miá»‡ng" },
            { name: "TrÃ  Ä‘Ã o cam sáº£", price: 35000, category: "Äá»“ uá»‘ng" },
            { name: "CÃ  phÃª sá»¯a Ä‘Ã¡", price: 30000, category: "Äá»“ uá»‘ng" },
            { name: "NÆ°á»›c cam tÆ°Æ¡i", price: 25000, category: "Äá»“ uá»‘ng" },
            { name: "Canh chua cÃ¡", price: 45000, category: "MÃ³n chÃ­nh" }
        ];

        const sampleTables = ["BÃ n 1", "BÃ n 2", "BÃ n 3", "BÃ n 4", "BÃ n 5", "BÃ n 6", "BÃ n 7", "BÃ n 8"];

        function generateOrderId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = 'DS-';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function getRandomMenuItems() {
            const numItems = Math.floor(Math.random() * 4) + 2;
            const selectedItems = [];
            const usedIndices = new Set();
            
            for (let i = 0; i < numItems; i++) {
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * sampleMenuItems.length);
                } while (usedIndices.has(randomIndex));
                
                usedIndices.add(randomIndex);
                const item = sampleMenuItems[randomIndex];
                const quantity = Math.floor(Math.random() * 3) + 1;
                
                selectedItems.push({
                    id: `item-${randomIndex}`,
                    name: item.name,
                    price: item.price,
                    quantity: quantity,
                    category: item.category,
                    notes: ""
                });
            }
            
            return selectedItems;
        }

        function calculateOrderTotals(items) {
            const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const total = subtotal;
            return { subtotal, total };
        }

        function createSampleOrder(orderNumber) {
            const orderId = generateOrderId();
            const table = sampleTables[Math.floor(Math.random() * sampleTables.length)];
            const items = getRandomMenuItems();
            const { subtotal, total } = calculateOrderTotals(items);
            const now = Timestamp.now();
            
            return {
                id: orderId,
                table: table,
                items: items,
                subtotal: subtotal,
                total: total,
                status: "completed",
                paymentStatus: null,
                orderTime: now,
                createdAt: now,
                updatedAt: now,
                customerCount: Math.floor(Math.random() * 6) + 1,
                notes: `ÄÆ¡n hÃ ng demo #${orderNumber} - Chá» thanh toÃ¡n`,
                waiterName: "Demo Waiter",
                waiterId: "demo-waiter-id"
            };
        }

        async function createSampleOrders() {
            console.log("ğŸš€ Äang táº¡o 5 Ä‘Æ¡n hÃ ng áº£o trÃªn Firebase Firestore...");
            
            try {
                const orders = [];
                
                for (let i = 1; i <= 5; i++) {
                    const sampleOrder = createSampleOrder(i);
                    console.log(`ğŸ“ Táº¡o Ä‘Æ¡n hÃ ng ${i}: ${sampleOrder.id} - ${sampleOrder.table} - ${sampleOrder.total.toLocaleString()}â‚«`);
                    
                    const docRef = await addDoc(collection(db, "orders"), sampleOrder);
                    console.log(`âœ… ÄÆ¡n hÃ ng ${sampleOrder.id} Ä‘Ã£ Ä‘Æ°á»£c táº¡o vá»›i ID: ${docRef.id}`);
                    
                    orders.push({
                        ...sampleOrder,
                        firestoreId: docRef.id
                    });
                }
                
                console.log("ğŸ‰ HoÃ n thÃ nh! ÄÃ£ táº¡o 5 Ä‘Æ¡n hÃ ng áº£o:");
                orders.forEach((order, index) => {
                    console.log(`${index + 1}. ${order.id} - ${order.table} - ${order.total.toLocaleString()}â‚«`);
                });
                
                console.log("ğŸ§ª BÃ¢y giá» báº¡n cÃ³ thá»ƒ test PayOS vá»›i cÃ¡c Ä‘Æ¡n hÃ ng nÃ y!");
                console.log("ğŸ“± Reload trang cashier-dashboard.html Ä‘á»ƒ xem cÃ¡c Ä‘Æ¡n hÃ ng má»›i");
                
                // Show success message
                addToOutput("ğŸ‰ THÃ€NH CÃ”NG! ÄÃ£ táº¡o 5 Ä‘Æ¡n hÃ ng áº£o!", 'success');
                addToOutput("ğŸ“± Báº¡n cÃ³ thá»ƒ má»Ÿ Cashier Dashboard Ä‘á»ƒ test PayOS", 'success');
                
                return orders;
                
            } catch (error) {
                console.error("âŒ Lá»—i khi táº¡o Ä‘Æ¡n hÃ ng áº£o:", error);
                addToOutput("âŒ Lá»–I: " + error.message, 'error');
                throw error;
            }
        }

        // Export to global scope
        window.createSampleOrders = createSampleOrders;

        console.log("ğŸ“¦ Script táº¡o Ä‘Æ¡n hÃ ng áº£o Ä‘Ã£ sáºµn sÃ ng!");
        console.log("ğŸ¯ Click nÃºt 'Táº¡o 5 Ä‘Æ¡n hÃ ng áº£o' Ä‘á»ƒ báº¯t Ä‘áº§u");
    </script>
</body>
</html>
