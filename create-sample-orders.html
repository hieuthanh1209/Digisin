<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o ƒë∆°n h√†ng ·∫£o - Firebase Setup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">üöÄ T·∫°o ƒë∆°n h√†ng ·∫£o cho test PayOS</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h5>üìã H∆∞·ªõng d·∫´n:</h5>
                            <ol>
                                <li>M·ªü <strong>F12 Developer Tools</strong></li>
                                <li>V√†o tab <strong>Console</strong></li>
                                <li>Ch·∫°y l·ªánh: <code>createSampleOrders()</code></li>
                                <li>ƒê·ª£i script t·∫°o 5 ƒë∆°n h√†ng ·∫£o</li>
                                <li>Quay l·∫°i <strong>cashier-dashboard.html</strong> ƒë·ªÉ test PayOS</li>
                            </ol>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <button class="btn btn-success btn-lg w-100" onclick="createSampleOrders()">
                                    üìù T·∫°o 5 ƒë∆°n h√†ng ·∫£o
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-info btn-lg w-100" onclick="window.open('../dashboard/cashier-dashboard.html', '_blank')">
                                    üí∞ M·ªü Cashier Dashboard
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5>üìä ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c t·∫°o:</h5>
                            <ul class="list-group">
                                <li class="list-group-item">‚úÖ Tr·∫°ng th√°i: <code>completed</code> (ho√†n th√†nh)</li>
                                <li class="list-group-item">üí≥ Payment Status: <code>null</code> (ch·ªù thanh to√°n)</li>
                                <li class="list-group-item">üçΩÔ∏è M√≥n ƒÉn: 2-5 m√≥n ng·∫´u nhi√™n</li>
                                <li class="list-group-item">üè† B√†n: B√†n 1-8 ng·∫´u nhi√™n</li>
                                <li class="list-group-item">üí∞ T·ªïng ti·ªÅn: 50,000‚Ç´ - 300,000‚Ç´</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <h5>üß™ Test PayOS:</h5>
                            <ol>
                                <li>Sau khi t·∫°o ƒë∆°n h√†ng, m·ªü <strong>Cashier Dashboard</strong></li>
                                <li>Ch·ªçn ƒë∆°n h√†ng v√† nh·∫•n <strong>"Thanh to√°n"</strong></li>
                                <li>Ch·ªçn ph∆∞∆°ng th·ª©c <strong>"PayOS"</strong></li>
                                <li>Test thanh to√°n v·ªõi server PayOS</li>
                            </ol>
                        </div>
                    </div>
                    <div class="card-footer text-muted">
                        <small>üí° Tip: M·ªü Console (F12) ƒë·ªÉ xem chi ti·∫øt qu√° tr√¨nh t·∫°o ƒë∆°n h√†ng</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Console Output -->
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>üì± Console Output</h5>
                    </div>
                    <div class="card-body">
                        <div id="console-output" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 200px; font-family: monospace;">
                            <div class="text-muted">Console output s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import and setup
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            Timestamp,
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import firebaseConfig from "../config/firebase-config.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Console output handler
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;

        function addToOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-danger' : (type === 'success' ? 'text-success' : 'text-dark');
            const div = document.createElement('div');
            div.className = color;
            div.innerHTML = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput(args.join(' '), 'error');
        };

        // Sample data
        const sampleMenuItems = [
            { name: "Ph·ªü b√≤ t√°i", price: 65000, category: "M√≥n ch√≠nh" },
            { name: "C∆°m g√† x·ªëi m·ª°", price: 55000, category: "M√≥n ch√≠nh" },
            { name: "B√°nh m√¨ th·ªãt n∆∞·ªõng", price: 25000, category: "M√≥n ph·ª•" },
            { name: "B√∫n b√≤ Hu·∫ø", price: 60000, category: "M√≥n ch√≠nh" },
            { name: "G·ªèi cu·ªën t√¥m th·ªãt", price: 35000, category: "Khai v·ªã" },
            { name: "B√°nh flan", price: 25000, category: "Tr√°ng mi·ªáng" },
            { name: "Tr√† ƒë√†o cam s·∫£", price: 35000, category: "ƒê·ªì u·ªëng" },
            { name: "C√† ph√™ s·ªØa ƒë√°", price: 30000, category: "ƒê·ªì u·ªëng" },
            { name: "N∆∞·ªõc cam t∆∞∆°i", price: 25000, category: "ƒê·ªì u·ªëng" },
            { name: "Canh chua c√°", price: 45000, category: "M√≥n ch√≠nh" }
        ];

        const sampleTables = ["B√†n 1", "B√†n 2", "B√†n 3", "B√†n 4", "B√†n 5", "B√†n 6", "B√†n 7", "B√†n 8"];

        function generateOrderId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = 'DS-';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function getRandomMenuItems() {
            const numItems = Math.floor(Math.random() * 4) + 2;
            const selectedItems = [];
            const usedIndices = new Set();
            
            for (let i = 0; i < numItems; i++) {
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * sampleMenuItems.length);
                } while (usedIndices.has(randomIndex));
                
                usedIndices.add(randomIndex);
                const item = sampleMenuItems[randomIndex];
                const quantity = Math.floor(Math.random() * 3) + 1;
                
                selectedItems.push({
                    id: `item-${randomIndex}`,
                    name: item.name,
                    price: item.price,
                    quantity: quantity,
                    category: item.category,
                    notes: ""
                });
            }
            
            return selectedItems;
        }

        function calculateOrderTotals(items) {
            const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const total = subtotal;
            return { subtotal, total };
        }

        function createSampleOrder(orderNumber) {
            const orderId = generateOrderId();
            const table = sampleTables[Math.floor(Math.random() * sampleTables.length)];
            const items = getRandomMenuItems();
            const { subtotal, total } = calculateOrderTotals(items);
            const now = Timestamp.now();
            
            return {
                id: orderId,
                table: table,
                items: items,
                subtotal: subtotal,
                total: total,
                status: "completed",
                paymentStatus: null,
                orderTime: now,
                createdAt: now,
                updatedAt: now,
                customerCount: Math.floor(Math.random() * 6) + 1,
                notes: `ƒê∆°n h√†ng demo #${orderNumber} - Ch·ªù thanh to√°n`,
                waiterName: "Demo Waiter",
                waiterId: "demo-waiter-id"
            };
        }

        async function createSampleOrders() {
            console.log("üöÄ ƒêang t·∫°o 5 ƒë∆°n h√†ng ·∫£o tr√™n Firebase Firestore...");
            
            try {
                const orders = [];
                
                for (let i = 1; i <= 5; i++) {
                    const sampleOrder = createSampleOrder(i);
                    console.log(`üìù T·∫°o ƒë∆°n h√†ng ${i}: ${sampleOrder.id} - ${sampleOrder.table} - ${sampleOrder.total.toLocaleString()}‚Ç´`);
                    
                    const docRef = await addDoc(collection(db, "orders"), sampleOrder);
                    console.log(`‚úÖ ƒê∆°n h√†ng ${sampleOrder.id} ƒë√£ ƒë∆∞·ª£c t·∫°o v·ªõi ID: ${docRef.id}`);
                    
                    orders.push({
                        ...sampleOrder,
                        firestoreId: docRef.id
                    });
                }
                
                console.log("üéâ Ho√†n th√†nh! ƒê√£ t·∫°o 5 ƒë∆°n h√†ng ·∫£o:");
                orders.forEach((order, index) => {
                    console.log(`${index + 1}. ${order.id} - ${order.table} - ${order.total.toLocaleString()}‚Ç´`);
                });
                
                console.log("üß™ B√¢y gi·ªù b·∫°n c√≥ th·ªÉ test PayOS v·ªõi c√°c ƒë∆°n h√†ng n√†y!");
                console.log("üì± Reload trang cashier-dashboard.html ƒë·ªÉ xem c√°c ƒë∆°n h√†ng m·ªõi");
                
                // Show success message
                addToOutput("üéâ TH√ÄNH C√îNG! ƒê√£ t·∫°o 5 ƒë∆°n h√†ng ·∫£o!", 'success');
                addToOutput("üì± B·∫°n c√≥ th·ªÉ m·ªü Cashier Dashboard ƒë·ªÉ test PayOS", 'success');
                
                return orders;
                
            } catch (error) {
                console.error("‚ùå L·ªói khi t·∫°o ƒë∆°n h√†ng ·∫£o:", error);
                addToOutput("‚ùå L·ªñI: " + error.message, 'error');
                throw error;
            }
        }

        // Export to global scope
        window.createSampleOrders = createSampleOrders;

        console.log("üì¶ Script t·∫°o ƒë∆°n h√†ng ·∫£o ƒë√£ s·∫µn s√†ng!");
        console.log("üéØ Click n√∫t 'T·∫°o 5 ƒë∆°n h√†ng ·∫£o' ƒë·ªÉ b·∫Øt ƒë·∫ßu");
    </script>
</body>
</html>
