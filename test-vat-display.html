<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test VAT Label Display</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .invoice { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .old { background: #fff8e1; border-color: #ffc107; }
        .new { background: #f8fff8; border-color: #28a745; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Test VAT Label Display</h1>
    
    <div>
        <button onclick="testScenario()">Run Complete Test Scenario</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div id="results"></div>
    <div id="log" class="log"></div>

    <script src="test-vat-labels.js"></script>
    
    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('log').textContent = '';
        }

        function testScenario() {
            log('üß™ Starting VAT Label Test Scenario...');
            
            // Run the tests
            const testResults = runVATLabelTests();
            
            // Display results in UI
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h3>Test Results</h3>
                
                <div class="invoice old">
                    <h4>üìã Old Invoice (Historical VAT Rate)</h4>
                    <p><strong>ID:</strong> ${testResults.oldInvoice.id}</p>
                    <p><strong>Created:</strong> ${new Date(testResults.oldInvoice.timestamp).toLocaleString('vi-VN')}</p>
                    <p><strong>Subtotal:</strong> ${formatCurrency(testResults.oldInvoice.subtotal)}</p>
                    <p><strong>${testResults.oldLabel}</strong> ${formatCurrency(testResults.oldInvoice.vat)}</p>
                    <p><strong>Total:</strong> ${formatCurrency(testResults.oldInvoice.total)}</p>
                </div>
                
                <div class="invoice new">
                    <h4>üìã New Invoice (Current VAT Rate)</h4>
                    <p><strong>ID:</strong> ${testResults.newInvoice.id}</p>
                    <p><strong>Created:</strong> ${new Date(testResults.newInvoice.timestamp).toLocaleString('vi-VN')}</p>
                    <p><strong>Subtotal:</strong> ${formatCurrency(testResults.newInvoice.subtotal)}</p>
                    <p><strong>${testResults.newLabel}</strong> ${formatCurrency(testResults.newInvoice.vat)}</p>
                    <p><strong>Total:</strong> ${formatCurrency(testResults.newInvoice.total)}</p>
                </div>
                
                <div style="padding: 15px; margin: 10px 0; border-radius: 5px; background: ${testResults.testPassed ? '#d4edda' : '#f8d7da'}; border: 1px solid ${testResults.testPassed ? '#c3e6cb' : '#f5c6cb'};">
                    <h4>${testResults.testPassed ? '‚úÖ TEST PASSED' : '‚ùå TEST FAILED'}</h4>
                    <p>${testResults.testPassed ? 'Invoices correctly display their historical VAT labels' : 'Invoices are not displaying historical VAT labels correctly'}</p>
                    <p><strong>Old Invoice Label:</strong> "${testResults.oldLabel}"</p>
                    <p><strong>New Invoice Label:</strong> "${testResults.newLabel}"</p>
                </div>
            `;
            
            log(`‚úÖ Test completed. Result: ${testResults.testPassed ? 'PASSED' : 'FAILED'}`);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
    </script>
</body>
</html>
